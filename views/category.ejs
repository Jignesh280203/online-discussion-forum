<%- include('layout', { title: 'Categories', body: `
<div class="max-w-5xl mx-auto">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Categories</h1>
    ${
      currentUser && (currentUser.role === 'moderator' || currentUser.role === 'admin')
        ? `<button onclick="document.getElementById('addCat').classList.toggle('hidden')" class="px-3 py-2 bg-accent-1 rounded">+ Add Category</button>`
        : ''
    }
  </div>

  ${
    currentUser && (currentUser.role === 'moderator' || currentUser.role === 'admin')
      ? `<div id="addCat" class="card p-6 rounded mb-6 hidden">
          <form action="/categories" method="POST" class="space-y-3">
            <input name="name" required placeholder="Category Name" class="w-full p-3 bg-transparent border rounded" />
            <input name="description" required placeholder="Description" class="w-full p-3 bg-transparent border rounded" />
            <div><button class="px-3 py-2 bg-accent-2 rounded">Create Category</button></div>
          </form>
        </div>`
      : ''
  }

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    ${
      categories && categories.length > 0
        ? categories.map(cat => `
          <div class="card p-5 rounded">
            <a href="/categories/${cat._id}" class="text-accent-1 font-semibold">${cat.name}</a>
            <p class="muted mt-2">${cat.description}</p>
            <div class="flex justify-between items-center mt-4">
              <span class="muted text-sm">Threads: <strong>${cat.count || 0}</strong></span>
              ${
                currentUser && (currentUser.role === 'moderator' || currentUser.role === 'admin')
                  ? `<form action="/categories/${cat._id}/delete" method="POST"><button onclick="return confirm('Delete?')" class="px-3 py-1 bg-danger text-white rounded text-xs">Delete</button></form>`
                  : ''
              }
            </div>
          </div>
        `).join('')
        : `<p class="muted">No categories yet.</p>`
    }
  </div>

</div>
` }) %>
