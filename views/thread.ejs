<%- include('layout', { title: 'Threads', body: `
<div class="max-w-5xl mx-auto">

  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">All Threads</h1>
    ${
      currentUser
        ? `<button id="openThreadBtn" class="px-3 py-2 bg-accent-1 rounded text-sm">+ New Thread</button>`
        : `<a href="/login" class="px-3 py-2 bg-white/5 rounded text-sm">Login to create</a>`
    }
  </div>

  ${
    currentUser
      ? `<div id="newThreadBox" class="card p-6 rounded mb-6 hidden">
          <form action="/threads" method="POST" class="space-y-3">
            <input name="title" required placeholder="Thread title" class="w-full p-3 bg-transparent border rounded" />
            <textarea name="content" required placeholder="Describe your thread..." class="w-full p-3 bg-transparent border rounded"></textarea>
            <div class="flex gap-2">
              <button class="px-4 py-2 bg-accent-2 rounded">Create Thread</button>
              <button type="button" id="cancelThread" class="px-4 py-2 bg-white/5 rounded">Cancel</button>
            </div>
          </form>
        </div>`
      : ''
  }

  ${
    (threads && threads.length > 0)
      ? `
      <div class="space-y-4">
        ${threads.map(t => `
          <div class="flex p-4 card rounded shadow">
            <div class="flex flex-col items-center mr-4">
              <form action="/threads/${t._id}/vote" method="POST">
                <input type="hidden" name="type" value="up">
                <button><i data-feather="arrow-up-circle"></i></button>
              </form>
              <div class="font-bold my-1">${t.votes || 0}</div>
              <form action="/threads/${t._1}/vote" method="POST">
                <input type="hidden" name="type" value="down">
                <button><i data-feather="arrow-down-circle"></i></button>
              </form>
            </div>

            <div class="flex-1">
              <a href="/threads/${t._id}" class="font-semibold text-accent-2">${t.title}</a>
              <p class="muted text-sm mt-1">${(t.content && t.content.length > 180) ? t.content.slice(0,180) + '...' : (t.content || '')}</p>
              <div class="muted text-xs mt-2">by ${t.author?.username || 'Anonymous'} • ${new Date(t.createdAt).toLocaleString()} • ${t.commentsCount || 0} comments</div>
            </div>
          </div>
        `).join('')}
      </div>
      `
      : `<p class="muted">No threads yet. Create the first thread!</p>`
  }

</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const openBtn = document.getElementById('openThreadBtn');
    const box = document.getElementById('newThreadBox');
    const cancel = document.getElementById('cancelThread');
    if (openBtn && box) openBtn.addEventListener('click', () => box.classList.toggle('hidden'));
    if (cancel && box) cancel.addEventListener('click', () => box.classList.add('hidden'));
  });
</script>
` }) %>
