<%- include("layout", {
  body: `

<div class="max-w-5xl mx-auto">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6" data-aos="fade-up">
    <h1 class="text-3xl font-bold text-slate-800">All Threads</h1>

    ${
      currentUser
        ? `<button id="openThreadBtn" class="px-4 py-2 bg-accent-1 text-white rounded shadow">+ New Thread</button>`
        : `<a href="/login" class="px-4 py-2 bg-white text-slate-900 rounded shadow">Login to create</a>`
    }
  </div>

  <!-- New Thread Form -->
  ${
    currentUser
      ? `
    <div id="newThreadBox" class="mb-6 bg-white p-6 rounded-xl shadow hidden" data-aos="fade-up">
      <form action="/threads" method="POST" class="space-y-3">
        <input name="title" required placeholder="Thread title" class="w-full p-3 border rounded" />
        <textarea name="content" required placeholder="Describe your thread..." class="w-full p-3 border rounded"></textarea>
        <div class="flex gap-2 items-center">
          <button class="px-4 py-2 bg-accent-3 text-white rounded">Create Thread</button>
          <button type="button" id="cancelThread" class="px-4 py-2 bg-slate-100 rounded">Cancel</button>
        </div>
      </form>
    </div>
      `
      : ""
  }

  <!-- Threads List -->
  ${
    threads && threads.length > 0
      ? `
    <div class="space-y-5">
      ${threads
        .map(
          (t) => `
      <div class="flex p-4 bg-white rounded-xl shadow hover:shadow-md transition" data-aos="fade-up">

        <!-- Votes -->
        <div class="flex flex-col items-center mr-5">
          <form action="/threads/${t._id}/vote" method="POST">
            <input type="hidden" name="type" value="up">
            <button type="submit" class="text-slate-500 hover:text-accent-1">
              <i data-feather="arrow-up-circle"></i>
            </button>
          </form>

          <div class="text-xl font-bold text-slate-700 my-1">${t.votes || 0}</div>

          <form action="/threads/${t._id}/vote" method="POST">
            <input type="hidden" name="type" value="down">
            <button type="submit" class="text-slate-500 hover:text-accent-1">
              <i data-feather="arrow-down-circle"></i>
            </button>
          </form>
        </div>

        <!-- Content -->
        <div class="flex-1">
          <a href="/threads/${t._id}" class="text-xl font-semibold text-slate-900 hover:text-accent-1">
            ${t.title}
          </a>

          <p class="text-slate-600 mt-1">
            ${
              t.content.length > 180
                ? t.content.slice(0, 180) + "â€¦"
                : t.content
            }
          </p>

          <div class="flex items-center gap-4 mt-3 text-sm text-slate-500">
            <span>ðŸ‘¤ ${t.author?.username || "Anonymous"}</span>
            <span>ðŸ•’ ${new Date(t.createdAt).toLocaleString()}</span>
            <span>ðŸ’¬ ${t.commentsCount || 0} Comments</span>
          </div>
        </div>

      </div>
      `
        )
        .join("")}
    </div>
      `
      : `<p class="text-center text-slate-600 text-lg">No threads yet. Be the first to create one!</p>`
  }

</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const openBtn = document.getElementById('openThreadBtn');
    const box = document.getElementById('newThreadBox');
    const cancel = document.getElementById('cancelThread');

    if (openBtn && box) {
      openBtn.addEventListener('click', () => box.classList.toggle('hidden'));
    }
    if (cancel && box) {
      cancel.addEventListener('click', () => box.classList.add('hidden'));
    }
  });
</script>

` }) %>
